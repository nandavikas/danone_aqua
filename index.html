<html>

<head>
    <!-- Load plotly.js into the DOM -->
<!--     <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
</head>

<body>
    <div id='myDiv'>
        <!-- Plotly chart will be drawn inside this DIV -->
    </div>
    <script>
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/',
            targetUrl = "https://app.yellowmessenger.com/api/data/functions/execute?bot=x1612155574013&botType=sandbox"
        var date = new Date();
        var currentIsoString = date.toISOString();
        var startdate = new Date(date);
        startdate.setMinutes(date.getMinutes() - 1)
        var previousIsoString = startdate.toISOString();
        console.log(currentIsoString)
        console.log(previousIsoString)
        // var settings = {
        //     "url": targetUrl,
        //     "method": "POST",
        //     "timeout": 0,
        //     "headers": {
        //         "Content-Type": "application/json",
        //         "x-auth-token": "ee375ae0c803da6e8581178c839d23029dec57a50c6ac45733102677a148afff",
        //         "Access-Control-Allow-Origin": true
        //     },
        //     "data": JSON.stringify({ "functionName": "postDataToWidget", "args": { "state": { "widgetBuilder": false, "currentPage": 1, "activeTab": "custom", "date": [currentIsoString, previousIsoString] }, "interval": `${currentIsoString}/${previousIsoString}` } }),
        // };

        // $.ajax(settings).done(function (response) {
        //     console.log(response);
        // });
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        myHeaders.append("x-auth-token", "ee375ae0c803da6e8581178c839d23029dec57a50c6ac45733102677a148afff");
        // myHeaders.append('Access-Control-Allow-Origin', 'http://localhost:3000');
        // myHeaders.append('Access-Control-Allow-Credentials', 'true');

        var raw = JSON.stringify({ "functionName": "postDataToWidget", "args": { "state": { "widgetBuilder": false, "currentPage": 1, "activeTab": "custom", "date": [currentIsoString, previousIsoString] }, "interval": `${currentIsoString}/${previousIsoString}` } });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        fetch(targetUrl, requestOptions)
            .then(response => response.text())
            .then(result => console.log(result.data))
            .catch(error => console.log('error', error));
        var data = [{
            values: [19, 26, 55],
            labels: ['Residential', 'Non-Residential', 'Utility'],
            type: 'pie'
        }];

        var layout = {
            height: 400,
            width: 500
        };

        Plotly.newPlot('myDiv', data, layout);
    </script>
</body>

</html>
